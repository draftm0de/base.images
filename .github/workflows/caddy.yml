name: Caddy Build Pipeline

on:
  workflow_dispatch:  # This enables the manual trigger

jobs: 
  build:
    uses: draftm0de/kernel.deployment/.github/workflows/build.yml@main
    with:
      namespace: "draftmode"
      image: "kernel.caddy"
      context: "caddy"
      build_args_file: ".build_args"
      artifact_name: "artifact"
    # build_target: (optional)
  scan:
    needs: build 
    uses: draftm0de/kernel.deployment/.github/workflows/scan.yml@main
    with:
      image: "kernel.caddy"    
      context: "caddy"
      artifact_name: "artifact"
      severity: "CRITICAL,HIGH"      
